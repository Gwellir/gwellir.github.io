<html ng-app="custom-webapp-ui" lang="en">
  <head>
    <!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!--Load the VueJS Library-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
      .selected {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <h1>Voting</h1>
      <h4>Candidates</h4>
      <div class="candidates">
        <div class="candidate_card" :class="{selected: candidate.selected}" v-for="candidate of candidates" :key="candidate.mal_cid">
            <img :src="candidate.img" :alt="candidate.name" height=150px @click="swapSelection(candidate)">
            <p>{{candidate.name}} ({{candidate.source}})</p>
        </div>
      </div>
    </div>
    <script>
      const app = new Vue({
        el: '#app',
        data: {
          app: window.Telegram.WebApp,
          candidates: [
            {mal_cid: 181419, name: 'Akito Yamada', source: 'Yamada-kun to Lv999 no Koi wo Suru', img: 'https://cdn.myanimelist.net/images/characters/6/489089.jpg', selected: false},
            {mal_cid: 181418, name: 'Akane Kinoshita', source: 'Yamada-kun to Lv999 no Koi wo Suru', img: 'https://cdn.myanimelist.net/images/characters/6/489090.jpg', selected: false},
          ],
        },
        methods: {
          swapSelection(candidate) {
            candidate.selected = !candidate.selected;
          },
          getSelected() {
            resultStr = '';
            for (c of this.candidates) {
              if (c.selected)
                resultStr = `${resultStr}1`;
              else
                resultStr = `${resultStr}0`;
            }
            console.log(resultStr);
          }
        },
        mounted(){
          const MainButton = this.app.MainButton;
          mainButton.text = "Send Results";
          mainButton.enable();
          mainButton.show();
          mainButton.onClick(function() {
            window.Telegram.WebApp.sendData(this.selectedString);
          });
        },
        computed: {
            selectedString() {
            resultStr = '';
            for (c of this.candidates) {
              if (c.selected)
                resultStr = `${resultStr}1`;
              else
                resultStr = `${resultStr}0`;
            }
            return resultStr;
          },
        },
      });
    </script>
  </body>
</html>
